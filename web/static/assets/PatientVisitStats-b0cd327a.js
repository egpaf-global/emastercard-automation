import{K as E}from"./vue-datepicker-358f2adb.js";import{_ as I}from"./LineChart.vue_vue_type_script_setup_true_lang-b648a147.js";import{H as P,ap as c,d as N,k as O,l as L,m as j,r as R,h as V,ak as z,_ as J,L as u,j as U,w as a,o as K,e as o,a as A,b as d,t as w}from"./index-2c23db35.js";import{i as W}from"./common-abc2f84d.js";import{R as F}from"./report_service-2f1cdd11.js";import{l as G}from"./loader-792d5ee5.js";import{D as H}from"./DrilldownTable-b8bdf000.js";import{i as q}from"./his_date-e2411856.js";import{t as M}from"./toasts-5b35ce85.js";import"./arrays-31d2d38b.js";import"./url-ffe761c9.js";import"./index-1ed2d771.js";class Q extends F{constructor(){super()}static getLocationName(){return sessionStorage.getItem("locationName")}getBookedAppointments(t){return P.getJson("programs/".concat(c,"/scheduled_appointments"),{date:t})}getViralLoadResults(t){return this.getReport("/programs/".concat(c,"/reports/high_vl_patients"),{range:t})}getOtherOutcome(t){return this.getReport("patient_outcome_list",{outcome:t})}getPatientVisitTypes(){return this.getReport("patient_visit_types")}getClientsDueForVl(){return this.getReport("clients_due_vl")}getClientRentention(){return this.getReport("/programs/".concat(c,"/reports/retention"))}getExternalConsultationClients(){return this.getReport("".concat(c,"/external_consultation_clients"))}getMissedAppointments(){return this.getReport("missed_appointments")}getPregnantWomen(){return this.getReport("/programs/".concat(c,"/reports/pregnant_patients"))}getArchivingCandidates(){return P.getJson("programs/".concat(c,"/reports/archiving_candidates"),{start_date:this.date})}getIncompleteVisits(){return this.getReport("incomplete_visits",{tool_name:"INCOMPLETE VISITS"})}getVisitStats(){return P.getJson("programs/".concat(c,"/reports/visits"),{name:"visits",start_date:this.startDate,end_date:this.endDate})}}const X=N({components:{LineChart:I,IonGrid:O,IonRow:L,IonCol:j,VueDatePicker:E},setup(){const e=R(""),t=R(""),l=R([]),C=V(()=>{var n;return((n=l.value[0])==null?void 0:n.raw.flat())||[]}),S=V(()=>{var n;return((n=l.value[1])==null?void 0:n.raw.flat())||[]}),$=V(()=>{var n;return((n=l.value[2])==null?void 0:n.raw.flat())||[]}),v=V(()=>l.value.map(({raw:n})=>n).flat(3)),y={title:{text:"Patient Visits Statistics",align:"left"},yaxis:{title:{text:"Number of clients"}}},_=n=>{const r={},p={},f={},i=[{name:"Patient present",raw:[],data:[]},{name:"Guardian present",raw:[],data:[]},{name:"Both patient and guardian present",raw:[],data:[]}];return Object.entries(n).forEach(([s,B])=>{r[s]=[],p[s]=[],f[s]=[],Object.entries(B).forEach(([b,{patient_present:k,guardian_present:T}])=>{T&&k?f[s].push({patientId:b,date:s}):k?r[s].push({patientId:b,date:s}):T&&p[s].push({patientId:b,date:s})});const D=new Date(s).getTime();i[0].data.push([D,r[s].length]),i[0].raw.push(r[s]),i[1].data.push([D,p[s].length]),i[1].raw.push(p[s]),i[2].data.push([D,f[s].length]),i[2].raw.push(f[s])}),i},g=async()=>{if(!q(e.value,t.value))return M("Invalid date range");try{G.show();const n=new Q;n.setStartDate(e.value),n.setEndDate(t.value);const r=await n.getPatientVisitTypes();l.value=_(r)}catch(n){console.error(n),M("Unable to generate patient visits data")}G.hide()},m=async(n,r="Drill down clients")=>{await z.show(H,{patientIds:n.map(({patientId:p})=>p),title:r})};return{startDate:e,endDate:t,series:l,options:y,totalAttendance:v,totalPatientVisits:C,totalGuardianVisits:S,totalBothVisits:$,fetchData:g,pointSelection:async(n,r)=>{if(!W(l.value))try{await m(l.value[r].raw[n],"".concat(l.value[r].name," visits"))}catch(p){console.error(p)}},drilldown:m}}}),Y={style:{display:"flex","justify-content":"flex-start"}},Z={class:"his-card"};function x(e,t,l,C,S,$){const v=u("vue-date-picker"),y=u("ion-button"),_=u("ion-col"),g=u("ion-label"),m=u("ion-badge"),h=u("ion-item"),n=u("ion-list"),r=u("line-chart"),p=u("ion-row"),f=u("ion-grid");return K(),U(f,null,{default:a(()=>[o(p,null,{default:a(()=>[o(_,{size:"6",offset:"6",class:"ion-padding"},{default:a(()=>[A("div",Y,[o(v,{modelValue:e.startDate,"onUpdate:modelValue":t[0]||(t[0]=i=>e.startDate=i),placeholder:"Start Date","enable-time-picker":!1,format:"dd/MMM/yyyy","auto-apply":"","text-input":"",class:"ion-margin-end"},null,8,["modelValue"]),o(v,{modelValue:e.endDate,"onUpdate:modelValue":t[1]||(t[1]=i=>e.endDate=i),placeholder:"End Date","enable-time-picker":!1,format:"dd/MMM/yyyy","auto-apply":"","text-input":"",class:"ion-margin-end"},null,8,["modelValue"]),o(y,{color:"primary",class:"ion-no-margin",onClick:e.fetchData},{default:a(()=>t[6]||(t[6]=[d("Generate")])),_:1},8,["onClick"])])]),_:1}),o(_,{size:"3",class:"ion-padding-top"},{default:a(()=>[A("div",Z,[o(n,null,{default:a(()=>[o(h,{button:"",onClick:t[2]||(t[2]=i=>e.drilldown(e.totalAttendance,"Total Attendance"))},{default:a(()=>[o(g,null,{default:a(()=>t[7]||(t[7]=[d("Total Attendance ")])),_:1}),o(m,null,{default:a(()=>[d(w(e.totalAttendance.length),1)]),_:1})]),_:1}),o(h,{button:"",onClick:t[3]||(t[3]=i=>e.drilldown(e.totalPatientVisits,"Total patient visits"))},{default:a(()=>[o(g,null,{default:a(()=>t[8]||(t[8]=[d("Patient Visit ")])),_:1}),o(m,null,{default:a(()=>[d(w(e.totalPatientVisits.length),1)]),_:1})]),_:1}),o(h,{button:"",onClick:t[4]||(t[4]=i=>e.drilldown(e.totalGuardianVisits,"Total guardian visits"))},{default:a(()=>[o(g,null,{default:a(()=>t[9]||(t[9]=[d("Guardian Visit ")])),_:1}),o(m,null,{default:a(()=>[d(w(e.totalGuardianVisits.length),1)]),_:1})]),_:1}),o(h,{button:"",onClick:t[5]||(t[5]=i=>e.drilldown(e.totalBothVisits,"Total patient and guardian visits"))},{default:a(()=>[o(g,null,{default:a(()=>t[10]||(t[10]=[d("Patient and Guardian Visit ")])),_:1}),o(m,null,{default:a(()=>[d(w(e.totalBothVisits.length),1)]),_:1})]),_:1})]),_:1})])]),_:1}),o(_,{size:"9"},{default:a(()=>[o(r,{style:{height:"600px"},series:e.series,options:e.options,onPointSelection:e.pointSelection,placeholder:"select date period"},null,8,["series","options","onPointSelection"])]),_:1})]),_:1})]),_:1})}const mt=J(X,[["render",x]]);export{mt as default};
