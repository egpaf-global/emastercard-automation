!function(){function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}System.register(["./index-legacy-a3ed4133.js","./arrays-legacy-4be31994.js","./his_date-legacy-0bc670a8.js","./encounter_types-legacy-aef9fff0.js","./patient_service-legacy-2479eb91.js"],(function(t,r){"use strict";var a,n,i,s,o,u,d,l,c,p,v;return{setters:[e=>{a=e.ap,n=e.H,i=e.r,s=e.h,o=e.a6},e=>{u=e.o},e=>{d=e.a,l=e.e},e=>{c=e.e},e=>{p=e.O,v=e.C}],execute:function(){t("u",(function(e){return f.value=e,{patientPrograms:m,programStates:b,hasArtProgram:D,fetchPatientPrograms:w,getProgramInfo:I,enrollPatient:_,voidProgram:y,voidState:O,updateState:V,hasProgram:E}}));class r{static create(e){const t={...e};return"program_id"in t||Object.assign(t,{program_id:a}),"encounter_datetime"in t||Object.assign(t,{encounter_datetime:d()}),n.postJson("/encounters",t)}static voidEncounter(e,t="Unknown"){return n.void(`/encounters/${e}`,{reason:t})}static getSavedEncounters(e,t=a){return n.getJson(`programs/${t}/patients/${e}/saved_encounters`)}static getEncounters(e,t={}){return n.getJson("/encounters",{program_id:a,patient_id:e,paginate:!1,...t})}}t("E",r);class g extends p{constructor(t,r,i){super(),e(this,"encounterTypeID",void 0),e(this,"programID",void 0),e(this,"encounterID",void 0),e(this,"providerID",void 0),e(this,"patientID",void 0),e(this,"date",void 0),this.encounterTypeID=r,this.patientID=t,this.encounterID=0,this.date=i,this.providerID=n.getProviderID(),this.programID=a}getDate(){return this.date}setDate(e){this.date=e}setEncounterID(e){this.encounterID=e}getEncounterID(){return this.encounterID}getFirstValueCoded(e){return g.getFirstValueCoded(this.patientID,e,this.date)}getFirstValueNumber(e){return g.getFirstValueNumber(this.patientID,e,this.date)}getFirstValueDatetime(e){return g.getFirstValueDatetime(this.patientID,e,this.date)}async buildObs(e,t){const r={...t,person_id:this.patientID,obs_datetime:this.date};return r.concept_id=await v.getConceptID(e),"string"==typeof t.value_coded&&(r.value_coded=await v.getConceptID(t.value_coded)),r}buildValueText(e,t){return g.buildValueText(e,t,this.date)}buildValueCoded(e,t){return g.buildValueCoded(e,t,this.date)}buildGroupValueCoded(e,t,r){return g.buildGroupValueCoded(e,t,r,this.date)}buildOptionsGroupObs(e,t){return Promise.all(t.map((async t=>this.buildGroupValueCoded(e,t.label,t.isChecked?"Yes":"No"))))}buildValueNumber(e,t,r=null,a=null){return g.buildValueNumber(e,t,this.date,r,a)}buildValueDate(e,t){return g.buildValueDate(e,t,this.date)}buildValueDateEstimated(e,t){return this.buildObs(e,{value_datetime:t,value_text:"Estimated"})}buildDateObs(e,t,r){return/unknown/i.test(t)?this.buildValueText(e,"Unknown"):r?this.buildValueDateEstimated(e,t):this.buildValueDate(e,t)}async saveObservationList(e){return p.saveObsArray(this.encounterID,e)}async saveValueTextObs(e,t){const r=await p.buildValueText(e,t,this.date);return this.saveObs(r)}async saveValueCodedObs(e,t){const r=await p.buildValueCoded(e,t,this.date);return this.saveObs(r)}async saveValueNumericObs(e,t,r=null){const a=await p.buildValueNumber(e,t,this.date,r);return this.saveObs(a)}async saveValueDatetimeObs(e,t){const r=await p.buildValueDate(e,t,this.date);return this.saveObs(r)}async createEncounter(){const e={encounter_type_id:this.encounterTypeID,patient_id:this.patientID,encounter_datetime:this.date};-1!=this.providerID&&(e.provider_id=this.providerID);const t=await r.create(e);if(t)return this.encounterID=t.data.encounter_id,t.data}saveObs(e){return g.saveObs(this.encounterID,e)}}t("A",g);const h=["Pre-ART (Continue)","On antiretrovirals","Treatment never started","Transferred internally","Discharged uninfected","Exposed Child (Continue)","Patient transferred in"],m=i([]),b=i(new Map),f=i(-1),D=s((()=>m.value.findIndex((e=>e.value===a))>=0));async function I(e,t=a){var r;const i=await n.getJson(`/programs/${t}/patients/${f.value}/visit?date=${e}`);if(!i.ok)throw new Error(null!==(r=i.errorMessage)&&void 0!==r?r:"Unable to load program information");return i.data}async function w(){var e,t;const r=await n.getJson(`patients/${f.value}/programs`);if(!r.ok)throw new Error(null!==(e=r.errorMessage)&&void 0!==e?e:"Failed to load patient programs");m.value=u(null!==(t=r.data)&&void 0!==t?t:[],"program.name","program_id")}async function y(e,t){var r;const a=await n.void(`patient_programs/${e}/`,{reason:t});if(!a.ok)throw new Error(null!==(r=a.errorMessage)&&void 0!==r?r:"Unable to void patient program")}async function O(e,t,r=a){var i;const s=await n.void(`programs/${r}/patients/${f.value}/states/${e}`,{reason:t});if(!s.ok)throw new Error(null!==(i=s.errorMessage)&&void 0!==i?i:"Unable to void patient program outcome")}async function V(e,t,r=a){var i;const s=await n.postJson(`programs/${r}/patients/${f.value}/states`,{state:e,date:l(t)});if(!s.ok)throw new Error(null!==(i=s.errorMessage)&&void 0!==i?i:"Unable to update patient program outcome")}function E(e=a){return b.value.has(e)}async function _(e,t=a){var r;const i=await n.postJson(`/patients/${f.value}/programs`,{program_id:t,date_enrolled:e});if(!i.ok)throw new Error(null!==(r=i.errorMessage)&&void 0!==r?r:"Unable to enroll patient into the the program")}o(m,(e=>{e.forEach((async e=>{const t=await async function(e=a){var t;const r=await n.getJson(`programs/${e}/workflows`);if(!r.ok)throw new Error(null!==(t=r.errorMessage)&&void 0!==t?t:"Failed to load program outcomes");const i=r.data.length>0?r.data[0].states:[],s=e===a?i.filter((e=>!h.includes(e.name))):i;return u(s,"name","program_workflow_state_id")}(e.value);b.value.set(e.value,t)}))}));t("V",class extends g{constructor(e,t=d()){super(e,c.VITALS,t)}});t("C",class extends g{constructor(e,t=d()){super(e,c.HIV_CLINIC_CONSULTATION,t)}getFamilyPlanningMethods(){return["ORAL CONTRACEPTIVE PILLS","DEPO-PROVERA","INTRAUTERINE CONTRACEPTION","CONTRACEPTIVE IMPLANT","MALE CONDOMS","FEMALE CONDOMS","TUBAL LIGATION","NONE"]}})}}}))}();
