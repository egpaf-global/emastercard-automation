import{d as h,m as _,n as z,I as E,a2 as N,r as S,h as y,aj as R,a8 as D,i as k,aq as O,_ as W,N as u,o as w,c as A,e as a,w as r,b as p,M as I,A as q}from"./index-51dd004c.js";import{T}from"./TextInput-1b036a7a.js";import{_ as U}from"./DateInput.vue_vue_type_style_index_0_lang-9c408a64.js";import{Y}from"./YesNoInput-458bf274.js";import{S as $}from"./SelectInput-e4566de2.js";import{g as B}from"./location_options-7f2abad1.js";import{s as P}from"./form-8b32afba.js";import{S as L}from"./HIVReception-0c0c5066.js";import{E as j,a as M}from"./emc_event-4721851b.js";import{r as v,v as G}from"./validations-6f974720.js";import"./his_date-126a9ecc.js";import"./vue-datepicker-1c0a0cbb.js";import"./common-abc2f84d.js";import"./Strs-0c962638.js";import"./toasts-4a7e4d69.js";import"./loader-c9c57168.js";import"./patient_service-a6ae3da8.js";import"./patient_identifier_service-7065756a.js";import"./Date-53be4074.js";import"./encounter_types-1e88a09d.js";import"./consultation_service-e56b7e07.js";import"./arrays-1b521787.js";const H=h({components:{IonRow:_,IonCol:z,IonButton:E,IonTitle:N,TextInput:T,DateInput:U,YesNoInput:Y,SelectInput:$},props:{patient:{type:Object,required:!0},isNewPatient:{type:Boolean,default:!0},observations:{type:Object,default:()=>({})},initialVisitDate:{type:String,default:""},artStartDate:{type:String,default:""}},emits:["onValue","onPrevious","onFinish"],setup(t,{emit:n}){const g=S([]),C=S([]),V=y(()=>t.patient.getBirthdate()),s=new L(t.patient.getID(),t.patient.getAge(),t.initialVisitDate),c=y(()=>s.getAllReasonsForART(t.artStartDate||t.initialVisitDate,t.patient.isMale()).map(o=>({label:o.name,value:o.name}))),m=s.getAllWhoStages().filter(o=>o.name.match(/1|2|3|4/i)).map(o=>({label:o.name,value:o.name})),i=R({reasonsForEligibity:{value:t.observations["Reason for ART eligibility"]||"",label:"Reason for Starting",placeholder:"Select Reason for Starting",required:!0,computedValue:o=>({obs:s.buildReasonForArtObs(typeof o=="string"?o:o.label)})},whoStage:{value:t.observations["Who stage"]||"",label:"Select Stage",placeholder:"Select Stage",required:!0,computedValue:o=>({obs:s.buildWhoStageObs(typeof o=="string"?o:o.label)})},cd4countAvailable:{value:t.observations["CD4 count"]?"Yes":"No",label:"Recent CD4 Count results available?",required:!0},cd4CountDate:{value:t.observations["Cd4 count datetime"]||"",label:"CD4 Count date",placeholder:"CD4 Count date",computedValue:o=>({obs:s.buildValueDate("Cd4 count datetime",o)}),validation:async(o,l)=>{var e;return((e=l.cd4countAvailable)==null?void 0:e.value)==="Yes"&&v(o)}},cd4Count:{value:t.observations["CD4 count"]||"",label:"CD4 Count",placeholder:"CD4 Count e.g. <100 or >500",computedValue:o=>{const l=parseInt(o.substring(1)),e=o.substring(0,1);return{modifier:e,count:l,obs:s.buildValueNumber("CD4 count",l,e)}},validation:async(o,l)=>{var e;return((e=l.cd4countAvailable)==null?void 0:e.value)==="Yes"&&G([()=>v(o),()=>s.cd4CountIsValid(o.value.toString())?null:["Please start with a modifier. e.g. >, <, or ="]])}},cd4CountLocation:{value:t.observations["Cd4 count location"]||"",label:"CD4 Count location",computedValue:o=>({obs:s.buildValueText("Cd4 count location",typeof o=="string"?o:o.label)}),validation:async(o,l)=>{var e;return((e=l.cd4countAvailable)==null?void 0:e.value)==="Yes"&&v(o)}},whoConditions:{value:t.observations["Who stages criteria present"]?[{label:t.observations["Who stages criteria present"],value:t.observations["Who stages criteria present"]}]:"",required:!0,label:"Select Staging Conditions",computedValue:o=>({obs:typeof o=="string"?s.buildWhoCriteriaObs(o):o.map(l=>s.buildWhoCriteriaObs(l.label))})}}),b=async()=>{if(await O("Are you sure you want to clear all fields?")){for(const o in i)i[o].value=void 0,i[o].error="";j.emit(M.ON_CLEAR)}},f=async()=>{s.setDate(t.initialVisitDate),await P(i,async(o,l)=>{n("onValue",{type:"staging",data:{formData:o,computedData:l}}),n("onFinish")})},d=o=>{o&&(i.whoConditions.value="");const l=parseInt((o==null?void 0:o.split(" ")[2])||"1");g.value=s.getStagingConditions(l).map(e=>({label:e.name,value:e.name,other:e})).sort((e,F)=>e.label.localeCompare(F.label))};return D(()=>i.whoStage.value,o=>d(o==null?void 0:o.label)),D(()=>i.reasonsForEligibity.value,()=>{i.whoStage.value="",i.whoConditions.value=""}),k(()=>d()),{patientDob:V,form:i,whoStages:m,stagingCoditions:g,selectedConditions:C,reasonsForArt:c,getFacilities:B,onClear:b,onSubmit:f}}});function J(t,n,g,C,V,s){const c=u("ion-title"),m=u("SelectInput"),i=u("ion-col"),b=u("yes-no-input"),f=u("DateInput"),d=u("text-input"),o=u("ion-button"),l=u("ion-row");return w(),A(I,null,[a(c,{class:"ion-text-center ion-margin-vertical ion-padding-bottom bold"},{default:r(()=>n[8]||(n[8]=[p(" Staging ")])),_:1}),a(l,{class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(i,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(m,{modelValue:t.form.reasonsForEligibity,"onUpdate:modelValue":n[0]||(n[0]=e=>t.form.reasonsForEligibity=e),options:t.reasonsForArt},null,8,["modelValue","options"])]),_:1}),a(i,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(m,{modelValue:t.form.whoStage,"onUpdate:modelValue":n[1]||(n[1]=e=>t.form.whoStage=e),options:t.whoStages},null,8,["modelValue","options"])]),_:1}),a(i,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(b,{modelValue:t.form.cd4countAvailable,"onUpdate:modelValue":n[2]||(n[2]=e=>t.form.cd4countAvailable=e),inline:""},null,8,["modelValue"])]),_:1}),t.form.cd4countAvailable.value==="Yes"?(w(),A(I,{key:0},[a(i,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(f,{modelValue:t.form.cd4CountDate,"onUpdate:modelValue":n[3]||(n[3]=e=>t.form.cd4CountDate=e),"min-date":t.patientDob,"max-date":t.initialVisitDate},null,8,["modelValue","min-date","max-date"])]),_:1}),a(i,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(d,{modelValue:t.form.cd4Count,"onUpdate:modelValue":n[4]||(n[4]=e=>t.form.cd4Count=e)},null,8,["modelValue"])]),_:1}),a(i,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(m,{modelValue:t.form.cd4CountLocation,"onUpdate:modelValue":n[5]||(n[5]=e=>t.form.cd4CountLocation=e),asyncOptions:t.getFacilities,allowCustom:""},null,8,["modelValue","asyncOptions"])]),_:1})],64)):q("",!0),a(i,{size:"6",class:"ion-margin-top ion-margin-bottom"},{default:r(()=>[a(m,{modelValue:t.form.whoConditions,"onUpdate:modelValue":n[6]||(n[6]=e=>t.form.whoConditions=e),options:t.stagingCoditions,multiple:""},null,8,["modelValue","options"])]),_:1}),a(i,{size:"12",class:"ion-margin-top"},{default:r(()=>[a(o,{class:"ion-margin-top ion-float-right",size:"large",onClick:t.onSubmit,color:"success"},{default:r(()=>n[9]||(n[9]=[p("Finish")])),_:1},8,["onClick"]),a(o,{class:"ion-margin-top ion-float-right",size:"large",color:"warning",onClick:t.onClear},{default:r(()=>n[10]||(n[10]=[p("Clear")])),_:1},8,["onClick"]),a(o,{class:"ion-margin-top ion-float-right",size:"large",onClick:n[7]||(n[7]=e=>t.$emit("onPrevious")),color:"primary"},{default:r(()=>n[11]||(n[11]=[p("Previous")])),_:1})]),_:1})]),_:1})],64)}const Co=W(H,[["render",J],["__scopeId","data-v-cc453135"]]);export{Co as default};
