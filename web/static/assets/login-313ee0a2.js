import{d as z,r as g,f as B,g as E,h as N,i as S,j as K,w as s,u as e,k as q,o as C,e as o,l as D,m as U,n as P,p as G,b as l,q as L,t as _,a as r,s as j,v as H,x as w,I as d,y as k,z as J,c as O,A as W,B as x,C as h,D as Q,E as X,F as Y,G as Z,H as $,J as ee,K as oe,_ as ae}from"./index-f2f481a8.js";import{r as y}from"./image-cb93bc3e.js";import{t as v}from"./toasts-b005746b.js";import{u as se}from"./PasswordUpdate-68565fcf.js";import"./TextInput-aa132a8f.js";import"./his_date-55cf9383.js";import"./validations-6f974720.js";import"./common-abc2f84d.js";import"./form-4f7d5c24.js";import"./Strs-0c962638.js";import"./loader-4fe30858.js";const te=["src"],le=["src"],re=["src"],ne={key:0},ie=z({__name:"login",setup(ue){const n=g(""),t=g(""),i=g(!1),I=B(),u=se(),{fullVersion:V}=ee(),{facility:c,loadFacilityCode:F,loadCurrentFacility:A}=q(),{initiateIdleTimer:M,stopIdleTimer:R}=E(),T=N(()=>I.currentRoute.value.redirectedFrom);S(()=>{R(),A(!0)});const m=async()=>{var p;try{if(!n.value||!t.value)return v("Invalid login details");const a=await oe.login(n.value,t.value);a.ok?(u.setCurrentPassword(t.value),await u.canChangePassword()&&await u.changePassword(),F(),M(),I.push((p=T.value)!=null?p:"/")):v(a.errorMessage)}catch(a){v("An error occurred while logging in"),console.error(a)}},b=()=>{i.value=!i.value};return(p,a)=>(C(),K(e($),null,{default:s(()=>[o(e(Z),null,{default:s(()=>[o(e(D),{style:{margin:"0",padding:"0"}},{default:s(()=>[o(e(U),null,{default:s(()=>[o(e(P),{size:"8"},{default:s(()=>[o(e(G),{class:"title"},{default:s(()=>a[2]||(a[2]=[l("e-mastercard-core APP")])),_:1}),o(e(L),{class:"sub-title"},{default:s(()=>[l(_(e(V)),1)]),_:1}),r("img",{src:e(y)("report.png"),class:"hero-image"},null,8,te),o(e(j),{class:"footer-section"},{default:s(()=>[o(e(H),null,{default:s(()=>[r("span",null,[r("img",{id:"coat",src:e(y)("login-logos/Malawi-Coat_of_arms_of_arms.png"),alt:"Malawi Coat of Arms logo",class:"brand-logo-moh"},null,8,le),r("img",{id:"pepfar",src:e(y)("login-logos/PEPFAR.png"),alt:"PEPFAR logo",class:"brand-logo-pepfar"},null,8,re)]),o(e(w),{class:"his-sm-text",slot:"end",lines:"none"},{default:s(()=>[o(e(d),{color:"dark",fill:"outline",size:"large",slot:"end","router-link":"/settings/network"},{default:s(()=>a[3]||(a[3]=[l(" Network ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(e(P),{size:"4",class:"form-section"},{default:s(()=>[o(e(k),{icon:e(J),class:"avatar"},null,8,["icon"]),e(c).name?(C(),O("h3",ne,_(e(c).name)+" ("+_(e(c).district)+")",1)):W("",!0),a[6]||(a[6]=r("h4",null,"Please, log into your account",-1)),o(e(w),{style:{margin:"2rem 3.5rem"}},{default:s(()=>[o(e(x),{type:"text",placeholder:"Username",modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=f=>n.value=f),onKeyup:h(m,["enter"]),min:5,required:""},null,8,["modelValue"])]),_:1}),o(e(w),{style:{margin:"2rem 3.5rem"}},{default:s(()=>[o(e(x),{type:i.value?"text":"password",modelValue:t.value,"onUpdate:modelValue":a[1]||(a[1]=f=>t.value=f),placeholder:"Password",onKeyup:h(m,["enter"]),max:100,min:5,required:""},{default:s(()=>[o(e(d),{slot:"end",fill:"clear",onClick:b},{default:s(()=>[o(e(k),{icon:i.value?e(Q):e(X)},null,8,["icon"])]),_:1})]),_:1},8,["type","modelValue"])]),_:1}),o(e(d),{expand:"full",size:"large",style:{margin:"2rem 3.5rem","text-transform":"none"},onClick:Y(m,["prevent"])},{default:s(()=>a[4]||(a[4]=[l(" Login ")])),_:1}),o(e(d),{fill:"clear",size:"large",color:"light",class:"ion-text-lowercase",onClick:e(u).showForgetPasswordModal},{default:s(()=>a[5]||(a[5]=[l(" forget password? ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});const Ce=ae(ie,[["__scopeId","data-v-e30111ea"]]);export{Ce as default};
