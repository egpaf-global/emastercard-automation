var m=Object.defineProperty;var u=(o,a,e)=>a in o?m(o,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[a]=e;var g=(o,a,e)=>(u(o,typeof a!="symbol"?a+"":a,e),e);import{a as l}from"./regimens-494dea9f.js";import{R as c}from"./report_service-7e51be12.js";import{i as R}from"./common-abc2f84d.js";class w extends c{constructor(){super();g(this,"type");this.type="pepfar"}setReportType(e){this.type=e}getTptNewInitiations(){return this.getReport("programs/".concat(this.programId,"/reports/tpt_newly_initiated"))}getRegimenFormulationReport(e,i){return this.getReport("programs/".concat(this.programId,"/reports/regimens_and_formulations"),{regimen:e,formulation:i})}async getRegimenReport(){const e=await this.getReport("regimen_report",{type:this.type});return this.regimenReportBuilder(e)}async getRegimenSwitchReport(){const e=await this.getReport("regimen_switch",{pepfar:this.isPepfar()});return this.regimenReportBuilder(e)}regimenReportBuilder(e){return Object.values(e!=null?e:{}).map(i=>{let r="";const s=i.medication.map(n=>(r=n.start_date,"".concat(n.medication," (").concat(n.quantity,")")));return{...i,dispensation_date:r,medications:s.join(", ")}})}regimenDistributionRowBuilder(e,i,r){const s={weight:e,gender:i,total:0};return[...l,"N/A"].reduce((n,t)=>{const p=r.find(d=>!R(d[t]));return p?(n[t]=p[t],n.total+=p[t]):n[t]=0,n},s)}async getRegimensByWeight(){const e=await this.getReport("programs/".concat(this.programId,"/reports/regimens_by_weight_and_gender")),i=[],r=[];return e==null||e.forEach(s=>{r.push(this.regimenDistributionRowBuilder(s.weight,"F",s.females)),i.push(this.regimenDistributionRowBuilder(s.weight,"M",s.males))}),[...r,...i]}getSCReport(){return this.getReport("sc_arvdisp",{pepfar:this.isPepfar()})}isPepfar(){return/pepfar/i.test(this.type)}async getRegimenDispensationReport(e){const i=[],r=await this.getReport("latest_regimen_dispensed",{rebuild_outcome:e});if(!r)return[];for(const s in r)for(const n in r[s]){const t=r[s][n];i.push({identifier:t.identifier,drugName:t.name,gender:t.gender,dob:t.birthdate,dispensationDate:t.dispensation_date,packSize:t.pack_sizes[0],packSizes:t.pack_sizes.length,quantity:t.quantity,vlResult:t.vl_latest_result,vlResultDate:t.vl_latest_result_date,vlOrderDate:t.vl_latest_order_date})}return i}}export{w as R};
