(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6956885e"],{"059d":function(t,e,n){},"2d24":function(t,e,n){"use strict";var a=n("f58f"),r=n.n(a);r.a},"3df9":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex",attrs:{id:"wrapper"}},[n("SideBar"),n("div",{attrs:{id:"page-content-wrapper"}},[n("TopNav"),n("div",{staticClass:"content"},[t._t("default")],2)],1)],1)},r=[],i=n("7c08"),s=n("ebd8"),c={name:"PageView",components:{SideBar:i["a"],TopNav:s["a"]}},o=c,l=(n("d1a5"),n("2877")),u=Object(l["a"])(o,a,r,!1,null,"09d8855c",null);e["a"]=u.exports},"3e2d":function(t,e,n){"use strict";var a=n("059d"),r=n.n(a);r.a},"555f":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.loading?n("div",{staticClass:"d-flex justify-content-center",attrs:{id:"loader"}},[t._m(0)]):t._e()},r=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"spinner-border",attrs:{role:"status"}},[n("span",{staticClass:"sr-only"},[t._v("Loading...")])])}],i={props:["loading"]},s=i,c=(n("2d24"),n("2877")),o=Object(c["a"])(s,a,r,!1,null,"6b6a65bc",null);e["a"]=o.exports},8370:function(t,e,n){},8519:function(t,e,n){},a434:function(t,e,n){"use strict";var a=n("23e7"),r=n("23cb"),i=n("a691"),s=n("50c4"),c=n("7b0b"),o=n("65f0"),l=n("8418"),u=n("1dde"),d=n("ae40"),f=u("splice"),p=d("splice",{ACCESSORS:!0,0:0,1:2}),h=Math.max,v=Math.min,m=9007199254740991,g="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!f||!p},{splice:function(t,e){var n,a,u,d,f,p,_=c(this),b=s(_.length),P=r(t,b),C=arguments.length;if(0===C?n=a=0:1===C?(n=0,a=b-P):(n=C-2,a=v(h(i(e),0),b-P)),b+n-a>m)throw TypeError(g);for(u=o(_,a),d=0;d<a;d++)f=P+d,f in _&&l(u,d,_[f]);if(u.length=a,n<a){for(d=P;d<b-a;d++)f=d+a,p=d+n,f in _?_[p]=_[f]:delete _[p];for(d=b;d>b-a+n;d--)delete _[d-1]}else if(n>a)for(d=b-a;d>P;d--)f=d+a-1,p=d+n-1,f in _?_[p]=_[f]:delete _[p];for(d=0;d<n;d++)_[d+P]=arguments[d+2];return _.length=b-a+n,u}})},c782:function(t,e,n){"use strict";var a=n("cd59"),r=n.n(a);r.a},cd59:function(t,e,n){},d1a5:function(t,e,n){"use strict";var a=n("8519"),r=n.n(a);r.a},dcc0:function(t,e,n){"use strict";var a=n("8370"),r=n.n(a);r.a},f58f:function(t,e,n){},f742:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("PageView",[n("div",{staticClass:"row"},t._l(t.errors,(function(e,a){return n("div",{key:a,staticClass:"alert alert-danger alert-dismissible fade show col-md-8 offset-md-2",attrs:{role:"alert"}},[t._v(" "+t._s(e)+" "),n("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"alert","aria-label":"Close"},on:{click:function(){return t.onDeleteError(a)}}},[n("span",{attrs:{"aria-hidden":"true"}},[t._v("Ã—")])])])})),0),n("div",{staticClass:"row",staticStyle:{margin:"0"}},[n("div",{staticClass:"col-md-5"},[n("h5",[t._v("Primary Patient")]),n("PatientList",{attrs:{patients:t.targetPatients},on:{"on-search":t.searchTargetPatients,"on-patient-selected":t.onSelectTargetPatient}})],1),n("div",{staticClass:"col-md-1"},[n("div",{staticStyle:{margin:"auto",position:"relative",top:"45%"}},[n("Loader",{attrs:{loading:t.isMerging}}),t.isMerging?t._e():n("i",{staticClass:"fas fa-chevron-left fa-3x"})],1)]),n("div",{staticClass:"col-md-5"},[n("h5",[t._v("Secondary Patient")]),n("PatientList",{attrs:{patients:t.sourcePatients},on:{"on-search":t.searchSourcePatients,"on-patient-selected":t.onSelectSourcePatient}})],1)]),n("button",{staticClass:"btn btn-primary btn-lg shadow",attrs:{id:"merge-button",disabled:t.isMerging},on:{click:t.mergeSelectedPatients}},[t._v(" Merge ")])])},r=[],i=(n("4de4"),n("a434"),n("96cf"),n("1da1")),s=n("8051"),c=n("50e8"),o=n("555f"),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"patient-list-container shadow rounded"},[n("form",{staticClass:"form",on:{submit:function(e){return e.preventDefault(),t.triggerSearch(e)}}},[n("div",{staticClass:"input-group mb-2 mr-sm-2"},[t._m(0),n("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Name or ARV Number"},domProps:{value:t.searchText},on:{input:function(e){e.target.composing||(t.searchText=e.target.value)}}})])]),n("div",{staticClass:"patient-list"},t._l(t.patients,(function(e){return n("PatientListItem",{key:e.patient_id,staticStyle:{width:"96%"},attrs:{patient:e,selected:e.patient_id===t.selectedPatientId},on:{"on-click":t.onPatientCardSelected}})})),1)])},u=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"input-group-prepend"},[n("div",{staticClass:"input-group-text"},[n("i",{staticClass:"fas fa-search"})])])}],d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"card mb-2 shadow-lg card-hover",class:t.selected&&"card-selected",staticStyle:{width:"100%"},on:{click:t.triggerOnClick}},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-md-3",staticStyle:{margin:"auto"}},[n("img",{staticClass:"card-img rounded-circle",attrs:{src:t.imageType,alt:"avatar"}})]),n("div",{staticClass:"col-md-8"},[n("div",{staticClass:"card-body"},[n("h5",{staticClass:"card-title",staticStyle:{"text-align":"left"}},[t._v(t._s(t.fullName)+" - "+t._s(t.arvNumber))]),n("table",{staticClass:"table patient-details"},[n("tbody",[n("tr",[n("td",[t._v("DoB:")]),n("td",[t._v(t._s(t.formattedAge))])]),n("tr",[n("td",[t._v("Phone #:")]),n("td",[t._v(t._s(t.phoneNumber))])]),n("tr",[n("td",[t._v("Address:")]),n("td",[t._v(t._s(t.address))])]),n("tr",[n("td",[t._v("Visits:")]),n("td",[t._v(t._s(t.visitsCount))])])])])])])])])},f=[],p=(n("99af"),n("b0c0"),n("c1df")),h=n.n(p),v=(n("a4d3"),n("e01a"),n("d28b"),n("d3b7"),n("3ca3"),n("ddb0"),function(){return{ATTR_LANDMARK:19,ATTR_CELLPHONE_NUMBER:12,ATTR_NEXT_OF_KIN:24,ATTR_NEXT_OF_KIN_CONTANT_NUMBER:25,getPersonAttribute:function(t,e){var n=!0,a=!1,r=void 0;try{for(var i,s=t.person_attributes[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;if(c.person_attribute_type_id==e)return c.value}}catch(o){a=!0,r=o}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}}}}()),m={props:["patient","selected"],created:function(){var t=this;s["a"].get("patients/".concat(this.patient.patient_id,"/visits")).then((function(t){return t.json()})).then((function(e){return t.visits=e}))},data:function(){return{visits:[]}},computed:{fullName:function(){var t=this.patient.person.names[0],e=t.given_name,n=t.family_name;return" ".concat(e," ").concat(n)},formattedAge:function(){return"".concat(h()(this.patient.person.birthdate).format("DD-MMM-YYYY")," (").concat(h()().diff(this.patient.person.birthdate,"years",!1)," years old)")},imageType:function(){return"M"===this.patient.person.gender?n("cf38"):n("3558")},arvNumber:function(){var t=this.patient.patient_identifiers.filter((function(t){return"ARV Number"===t.type.name}));return t.length>0?t[0].identifier:"N/A"},address:function(){return v.getPersonAttribute(this.patient.person,v.ATTR_LANDMARK)||"Unknown"},phoneNumber:function(){return v.getPersonAttribute(this.patient.person,v.ATTR_CELLPHONE_NUMBER)||"Unknown"},visitsCount:function(){return this.visits.length}},methods:{triggerOnClick:function(){this.$emit("on-click",this.patient.patient_id)}}},g=m,_=(n("dcc0"),n("2877")),b=Object(_["a"])(g,d,f,!1,null,"7b83db7f",null),P=b.exports,C={components:{PatientListItem:P},props:["patients"],data:function(){return{searchText:"",selectedPatientId:null}},methods:{triggerSearch:function(){this.$emit("on-search",this.searchText)},onPatientCardSelected:function(t){this.selectedPatientId=t,this.$emit("on-patient-selected",t)}}},x=C,w=(n("c782"),Object(_["a"])(x,l,u,!1,null,"cc3946ae",null)),y=w.exports,T=n("3df9"),S={components:{Loader:o["a"],PatientList:y,PageView:T["a"]},props:["patients"],data:function(){return{targetPatients:[],targetName:null,targetPatientId:null,sourcePatients:[],sourceName:null,sourcePatientId:null,errors:[],isMerging:!1}},methods:{searchTargetPatients:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,c["a"].searchPatients({searchText:t});case 3:e.targetPatients=n.sent,n.next=9;break;case 6:n.prev=6,n.t0=n["catch"](0),alert(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))()},searchSourcePatients:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,c["a"].searchPatients({searchText:t});case 3:e.sourcePatients=n.sent,n.next=9;break;case 6:n.prev=6,n.t0=n["catch"](0),alert(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))()},onSelectTargetPatient:function(t){this.targetPatientId=t},onSelectSourcePatient:function(t){this.sourcePatientId=t},onDeleteError:function(t){this.errors.splice(t,1)},mergeSelectedPatients:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.validateSelection()){e.next=2;break}return e.abrupt("return");case 2:return t.isMerging=!0,n=[{doc_id:null,patient_id:t.sourcePatientId}],a={doc_id:null,patient_id:t.targetPatientId},e.next=7,s["a"].post("dde/patients/merge",{secondary:n,primary:a,program_id:1});case 7:if(r=e.sent,200===r.status){e.next=15;break}return e.next=11,r.text();case 11:return i=e.sent,t.errors=["Merge failed: API responded: ".concat(i)],t.isMerging=!1,e.abrupt("return");case 15:t.sourcePatients=t.sourcePatients.filter((function(e){var n=e.patient_id;return n!=t.sourcePatientId})),t.targetPatients=t.targetPatients.filter((function(e){var n=e.patient_id;return n!=t.sourcePatientId})),t.sourcePatientId=null,t.isMerging=!1;case 19:case"end":return e.stop()}}),e)})))()},validateSelection:function(){return this.targetPatientId?this.sourcePatientId?this.targetPatientId!==this.sourcePatientId||(this.errors=["Can't merge patient to self"],!1):(this.errors=["Please select a source patient"],!1):(this.errors=["Please select a target patient"],!1)}}},N=S,A=(n("3e2d"),Object(_["a"])(N,a,r,!1,null,"3b58a392",null));e["default"]=A.exports}}]);
//# sourceMappingURL=chunk-6956885e.e726159a.js.map