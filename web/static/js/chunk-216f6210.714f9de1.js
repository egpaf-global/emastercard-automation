(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-216f6210"],{"0bb4":function(e,t,n){},1648:function(e,t,n){"use strict";n.r(t);var o=n("7a23");const a={style:{display:"flex","justify-content":"flex-start"}},r={class:"his-card"};function c(e,t,n,c,i,l){const s=Object(o["resolveComponent"])("date-range-picker"),d=Object(o["resolveComponent"])("ion-button"),u=Object(o["resolveComponent"])("ion-col"),p=Object(o["resolveComponent"])("ion-label"),b=Object(o["resolveComponent"])("ion-badge"),m=Object(o["resolveComponent"])("ion-item"),f=Object(o["resolveComponent"])("ion-list"),j=Object(o["resolveComponent"])("line-chart"),O=Object(o["resolveComponent"])("ion-row"),h=Object(o["resolveComponent"])("ion-grid");return Object(o["openBlock"])(),Object(o["createBlock"])(h,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(O,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(u,{size:"3",offset:"9",class:"ion-padding"},{default:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("div",a,[Object(o["createVNode"])(s,{modelValue:e.range,"onUpdate:modelValue":t[0]||(t[0]=t=>e.range=t),class:"ion-margin-end",style:{padding:"5px"}},null,8,["modelValue"]),Object(o["createVNode"])(d,{color:"primary",onClick:e.fetchData,style:{height:"44px"}},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("Submit")]),_:1},8,["onClick"])])]),_:1}),Object(o["createVNode"])(u,{size:"2",class:"ion-padding-top"},{default:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("div",r,[Object(o["createVNode"])(f,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(m,{button:"",onClick:t[1]||(t[1]=t=>e.drilldown(e.totalAttendance,"Total Attendance"))},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(p,null,{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(" Total Attendance ")]),_:1}),Object(o["createVNode"])(b,null,{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.totalAttendance.length),1)]),_:1})]),_:1}),Object(o["createVNode"])(m,{button:"",onClick:t[2]||(t[2]=t=>e.drilldown(e.totalPatientVisits,"Total patient visits"))},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(p,null,{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(" Patient Visit ")]),_:1}),Object(o["createVNode"])(b,null,{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.totalPatientVisits.length),1)]),_:1})]),_:1}),Object(o["createVNode"])(m,{button:"",onClick:t[3]||(t[3]=t=>e.drilldown(e.totalGuardianVisits,"Total guardian visits"))},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(p,null,{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(" Guardian Visit ")]),_:1}),Object(o["createVNode"])(b,null,{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.totalGuardianVisits.length),1)]),_:1})]),_:1})]),_:1})])]),_:1}),Object(o["createVNode"])(u,{size:"10"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(j,{series:e.series,options:e.options,onPointSelection:e.pointSelection,placeholder:"select date period"},null,8,["series","options","onPointSelection"])]),_:1})]),_:1})]),_:1})}n("14d9");var i=n("c5be"),l=n("d867"),s=n("2ef0"),d=n("7717"),u=n("ad8d"),p=n("b211"),b=n("23e6"),m=n("da44"),f=n("564f"),j=n("6605"),O=n("9283"),h=n("0011"),w=n("3a8c"),C=Object(o["defineComponent"])({components:{LineChart:i["a"],IonGrid:l["IonGrid"],IonRow:l["IonRow"],IonCol:l["IonCol"],DateRangePicker:d["a"]},setup(){const e=Object(j["i"])(),t=Object(o["ref"])({}),n=Object(o["ref"])([]),a=Object(o["computed"])(()=>{var e;return(null===(e=n.value[0])||void 0===e?void 0:e.raw.flat())||[]}),r=Object(o["computed"])(()=>{var e;return(null===(e=n.value[1])||void 0===e?void 0:e.raw.flat())||[]}),c=Object(o["computed"])(()=>n.value.map(({raw:e})=>e).flat(3)),i={title:{text:"Patient Vists Statistics",align:"left"},yaxis:{title:{text:"Number of clients"},plotAreaHeight:800}},l=e=>{const t={},n={},o={},a=[{name:"Patient present",raw:[],data:[]},{name:"Guardian present",raw:[],data:[]},{name:"Both patient and guardian present",raw:[],data:[]}];return Object.entries(e).forEach(([e,r])=>{t[e]=[],n[e]=[],o[e]=[],Object.entries(r).forEach(([a,{patient_present:r,guardian_present:c}])=>{c&&r?o[e].push({patientId:a,date:e}):r?t[e].push({patientId:a,date:e}):c&&n[e].push({patientId:a,date:e})});const c=new Date(e).getTime();a[0].data.push([c,t[e].length]),a[0].raw.push(t[e]),a[1].data.push([c,n[e].length]),a[1].raw.push(n[e]),a[2].data.push([c,o[e].length]),a[2].raw.push(o[e])}),a},d=async()=>{p["a"].show();const e=new u["b"];e.setStartDate(t.value.start),e.setEndDate(t.value.end);const o=await e.getPatientVisitTypes();n.value=l(o),p["a"].hide()},C=async e=>{const t=await b["a"].findByID(e),n=new b["a"](t);return{arv_number:n.getArvNumber(),birthdate:n.getBirthdate(),gender:n.getGender(),address:""+n.getCurrentVillage(),...t}},v=async(t,n="Drill down clients")=>{if(Object(s["isEmpty"])(t))return;const a=[{path:"arv_number",label:"ARV Number",initialSort:!0,initialSortOrder:"asc",preSort:w["a"]},{path:"birthdate",label:"Date of Birth",formatter:O["c"].toStandardHisDisplayFormat},{path:"gender",label:"Gender",formatter:h["i"]},{path:"date",label:"Visit Date",formatter:O["c"].toStandardHisDisplayFormat},{path:"address",label:"Address"}],r=Object(o["ref"])([]),c=async()=>{for(const{patientId:e,date:n}of t){const t=await C(e);r.value.push({...t,date:n})}};c();const i=[{label:"Select",action:t=>e.push("/emc/patient/"+t["patient_id"])}];await m["a"].show(f["a"],{title:n,columns:a,rows:r.value,rowActionButtons:i})},g=async(e,t)=>{if(!Object(s["isEmpty"])(n.value))try{await v(n.value[t].raw[e],n.value[t].name+" visits")}catch(o){console.error(o)}};return{range:t,series:n,options:i,totalAttendance:c,totalPatientVisits:a,totalGuardianVisits:r,fetchData:d,pointSelection:g,drilldown:v}}}),v=n("6b0d"),g=n.n(v);const y=g()(C,[["render",c]]);t["default"]=y},"3a8c":function(e,t,n){"use strict";function o(e){return parseInt(e.split("-")[2])||0}n.d(t,"a",(function(){return o}))},"40e3":function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return O})),n.d(t,"b",(function(){return h}));n("88a7"),n("271a"),n("5494");var o=n("4971"),a=n("2ef0"),r=n("1c74"),c=n("5a0c"),i=n.n(c),l=n("8baf"),s=n("0da4"),d=n.n(s);function u(e){try{return e.replace(/<(?:.|\n)*?>/gm," ").replace(/(\r\n|\n|\r)/gm,"").replace(/\n/g," ").replace(/\t/g," ").replace(/\s{2,}/g," ").replace(/=/g," ").replace(/,/g," ").trim()}catch(t){return e}}function p(){const e=r["e"].getUserName();return{encryption:{userPassword:e,ownerPassword:e,userPermissions:["print"]}}}function b(e,t){return t||!1!==e.exportable}function m(e,t=!1){return e.filter(e=>b(e,t)).map(e=>e.label)}function f(e,t,n=!1){return t.map(t=>e.filter(e=>b(e,n)).map(e=>{let n=Object(a["get"])(t,e.path);return"function"===typeof e.formatter&&n&&(n=e.formatter(n,t)),u(e.drillable&&Array.isArray(n)?n.length:n)}))}function j(e){const{columns:t,rows:n,quarter:a,period:c,filters:l,safeMode:s}=e,d=m(t,s),u=f(t,Object(o["sortRows"])(n,(null===l||void 0===l?void 0:l.sort)||[]),s);let p=d.join(",")+"\n";return p+=u.map(e=>e.join(",")).join("\n"),p+="\nDate Created:  "+i()().format("DD/MMM/YYYY HH:MM:ss"),a&&(p+="\nQuarter: "+a),c&&(p+="\nQuarter: "+c),p+="\ne-Mastercard Version : "+r["e"].getAppVersion(),p+="\nAPI Version "+r["e"].getApiVersion(),p+="\nSite UUID: "+r["e"].getSiteUUID(),p}function O(e){const t=new Blob([j(e)],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=window.URL.createObjectURL(t),n.setAttribute("download",e.filename+".csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function h(e){const{filename:t,canHorizontalPageBreak:n,columns:a,rows:r,filters:c,safeMode:i}=e,s=[m(a,i)],b=f(a,Object(o["sortRows"])(r,(null===c||void 0===c?void 0:c.sort)||[]),i),j=i?p():{},O=new l["default"]({...j}),h=O.splitTextToSize(u(t),180),w=h.length<=1?20:10*h.length;O.text(h,14,10);const C={startY:w,head:s,body:b};n&&(C.tableWidth="wrap",C.horizontalPageBreak=!0,C.horizontalPageBreakRepeat=0),d()(O,C);const v=t+".pdf";O.save(v)}},"564f":function(e,t,n){"use strict";var o=n("7a23");function a(e,t,n,a,r,c){const i=Object(o["resolveComponent"])("IonIcon"),l=Object(o["resolveComponent"])("IonButton"),s=Object(o["resolveComponent"])("IonButtons"),d=Object(o["resolveComponent"])("IonTitle"),u=Object(o["resolveComponent"])("IonToolbar"),p=Object(o["resolveComponent"])("IonHeader"),b=Object(o["resolveComponent"])("data-table"),m=Object(o["resolveComponent"])("IonContent"),f=Object(o["resolveComponent"])("IonPage");return Object(o["openBlock"])(),Object(o["createBlock"])(f,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(p,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(u,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(s,{slot:"end"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(l,{slot:"end",onClick:t[0]||(t[0]=t=>e.modal.hide()),"icon-only":""},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,{icon:e.close},null,8,["icon"])]),_:1})]),_:1}),Object(o["createVNode"])(d,null,{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.title),1)]),_:1})]),_:1})]),_:1}),Object(o["createVNode"])(m,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(b,{rows:e.rows,"async-rows":e.asyncRows,columns:e.columns,"row-actions-buttons":e.rowActionButtons,"actions-buttons":e.actionBtns,color:"custom"},null,8,["rows","async-rows","columns","row-actions-buttons","actions-buttons"])]),_:1})]),_:1})}n("14d9");var r=n("d867"),c=n("4971"),i=n("ff79"),l=n("da44"),s=n("5a0c"),d=n.n(s),u=n("40e3"),p=Object(o["defineComponent"])({name:"DrilldownTable",components:{DataTable:c["DataTable"],IonButton:r["IonButton"],IonPage:r["IonPage"],IonHeader:r["IonHeader"],IonContent:r["IonContent"],IonToolbar:r["IonToolbar"],IonButtons:r["IonButtons"],IonTitle:r["IonTitle"],IonIcon:r["IonIcon"]},props:{title:{type:String,default:"Report"},rows:{type:Array,default:()=>[]},asyncRows:{type:Function},columns:{type:Array,default:()=>[]},rowActionButtons:{type:Array,default:()=>[]},actionButtons:{type:Array,default:()=>[]},canExportCsv:{type:Boolean,default:!0},period:{type:String,default:""}},setup(e){const t=Object(o["computed"])(()=>{const t=[...e.actionButtons];return e.canExportCsv&&t.push({label:"CSV",color:"primary",action:async(t,n,o,a)=>Object(u["a"])({rows:n,filters:o,columns:a,period:e.period.includes("Custom")?e.period.substring(6):e.period,filename:`${e.title}-${d()().format("DD-MMM-YYYY")}`})}),t});return{close:i["close"],modal:l["a"],actionBtns:t}}}),b=n("6b0d"),m=n.n(b);const f=m()(p,[["render",a]]);t["a"]=f},6361:function(e,t,n){"use strict";n("0bb4")},7717:function(e,t,n){"use strict";var o=n("7a23");const a={class:"date-picker-wrapper"},r=["value"],c=["value"];function i(e,t,n,i,l,s){const d=Object(o["resolveComponent"])("ion-icon"),u=Object(o["resolveComponent"])("date-picker");return Object(o["openBlock"])(),Object(o["createBlock"])(u,{modelValue:e.range,"onUpdate:modelValue":t[0]||(t[0]=t=>e.range=t),"is-range":"",masks:e.masks,popover:e.popover},{default:Object(o["withCtx"])(({inputValue:t,inputEvents:n})=>[Object(o["createElementVNode"])("div",a,[Object(o["createElementVNode"])("input",Object(o["mergeProps"])({value:t.start,class:"box date-picker-input"},Object(o["toHandlers"])(n.start,!0),{placeholder:"DD/MMM/YYYY"}),null,16,r),Object(o["createVNode"])(d,{icon:e.arrowForward,class:"date-picker-icon"},null,8,["icon"]),Object(o["createElementVNode"])("input",Object(o["mergeProps"])({value:t.end,class:"box date-picker-input"},Object(o["toHandlers"])(n.start,!0),{placeholder:"DD/MMM/YYYY"}),null,16,c)])]),_:1},8,["modelValue","masks","popover"])}var l=n("d867"),s=n("ff79"),d=n("0261"),u=n("9283"),p=Object(o["defineComponent"])({name:"DateRangePicker",components:{IonIcon:l["IonIcon"],DatePicker:d["b"]},props:{modelValue:{type:Object,default:()=>({start:"",end:""})}},emits:["update:modelValue"],setup(e,{emit:t}){const n=Object(o["ref"])({input:"DD/MMM/YYYY"}),a=Object(o["ref"])({visibility:"click"}),r=Object(o["computed"])({get:()=>e.modelValue,set:({start:e,end:n})=>t("update:modelValue",{start:u["c"].toStandardHisFormat(e),end:u["c"].toStandardHisFormat(n)})});return{arrowForward:s["arrowForward"],range:r,masks:n,popover:a}}}),b=(n("6361"),n("6b0d")),m=n.n(b);const f=m()(p,[["render",i],["__scopeId","data-v-4991088d"]]);t["a"]=f},c5be:function(e,t,n){"use strict";var o=n("7a23");function a(e,t,n,a,r,c){const i=Object(o["resolveComponent"])("apex-chart"),l=Object(o["resolveComponent"])("ion-card-content"),s=Object(o["resolveComponent"])("ion-card");return Object(o["openBlock"])(),Object(o["createBlock"])(s,{class:"his-card",style:{height:"100%"}},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(l,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,{width:"100%",height:e.height,type:"line",options:e.chartOptions,series:e.series,onMarkerClick:e.onPointSelection},null,8,["height","options","series","onMarkerClick"])]),_:1})]),_:1})}var r=n("d867"),c=n("ae27"),i=n.n(c),l=Object(o["defineComponent"])({name:"LineChart",props:{series:{type:Array,default:()=>[]},options:{type:Object,default:()=>({})},height:{type:[String,Number],default:560},placeholder:{type:String,default:"Loading data..."}},components:{IonCard:r["IonCard"],IonCardContent:r["IonCardContent"],ApexChart:i.a},emits:["pointSelection"],setup(e,{emit:t}){const n=Object(o["computed"])(()=>{const t={chart:{id:"line-chart",type:"line"},xaxis:{type:"datetime",tickAmount:2,labels:{show:!0,rotate:-75}},markers:{size:8,hover:{sizeOffset:3}},tooltip:{x:{format:"dd/MMM/yyyy"}},title:{text:"Line Chart",align:"left"},noData:{text:e.placeholder,align:"center",verticalAlign:"middle",offsetX:0,offsetY:0,style:{color:"#a7a7a7",fontSize:"25px",fontFamily:"Helvetica"}}};for(const n in e.options)t[n]={...t[n],...e.options[n]};return t}),a=(e,n,{dataPointIndex:o,seriesIndex:a})=>{console.log(e,n),t("pointSelection",o,a<=0?0:a)};return{chartOptions:n,onPointSelection:a}}}),s=n("6b0d"),d=n.n(s);const u=d()(l,[["render",a]]);t["a"]=u},da44:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n("d867");const a={async show(e,t,n="custom-modal",a=!0){const r=await o["modalController"].create({component:e,cssClass:n,backdropDismiss:a,componentProps:t});r.present();const{data:c}=await r.onWillDismiss();if(c)return c},async hide(e){await o["modalController"].dismiss(e)}}}}]);
//# sourceMappingURL=chunk-216f6210.714f9de1.js.map