{"version":3,"sources":["webpack:///./src/views/MergeRollback.vue?3e33","webpack:///./src/views/MergeRollback.vue?ca2e","webpack:///./src/services/merging_service.ts","webpack:///./src/views/MergeRollback.vue","webpack:///./src/views/MergeRollback.vue?82e0"],"names":["render","_ctx","_cache","$props","$setup","$data","$options","_component_ion_text","_resolveComponent","_component_ion_title","_component_ion_toolbar","_component_ion_header","_component_ion_label","_component_ion_item","_component_ion_list","_component_report_table","_component_ion_content","_component_ion_button","_component_ion_footer","_component_ion_page","_openBlock","_createBlock","default","_withCtx","_createVNode","class","color","_createTextVNode","_toDisplayString","npid","_","lines","_createElementVNode","holderName","_createElementBlock","_Fragment","_renderList","patientInfo","item","index","key","label","value","config","tableCssTheme","columns","rows","onClick","cancel","size","slot","rollback","disabled","isReversible","MergingService","Service","identifier","this","getJson","patientID","postJson","getProgramID","defineComponent","components","IonText","IonPage","IonContent","IonToolbar","IonHeader","IonFooter","IonTitle","IonList","IonItem","IonLabel","IonButton","ReportTable","setup","route","useRoute","router","useRouter","ref","results","params","id","toUpperCase","table","thTxt","computed","length","back","async","alertConfirmation","toastDanger","onMounted","getMergeHistory","e","map","HisDate","toStandardHisDisplayFormat","td","tdDate","__exports__"],"mappings":"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","file":"js/chunk-a279802a.d5bcfdd6.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./MergeRollback.vue?vue&type=style&index=0&id=45cde8b0&scoped=true&lang=css\"","import { toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock } from \"vue\"\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  const _component_ion_text = _resolveComponent(\"ion-text\")!\n  const _component_ion_title = _resolveComponent(\"ion-title\")!\n  const _component_ion_toolbar = _resolveComponent(\"ion-toolbar\")!\n  const _component_ion_header = _resolveComponent(\"ion-header\")!\n  const _component_ion_label = _resolveComponent(\"ion-label\")!\n  const _component_ion_item = _resolveComponent(\"ion-item\")!\n  const _component_ion_list = _resolveComponent(\"ion-list\")!\n  const _component_report_table = _resolveComponent(\"report-table\")!\n  const _component_ion_content = _resolveComponent(\"ion-content\")!\n  const _component_ion_button = _resolveComponent(\"ion-button\")!\n  const _component_ion_footer = _resolveComponent(\"ion-footer\")!\n  const _component_ion_page = _resolveComponent(\"ion-page\")!\n\n  return (_openBlock(), _createBlock(_component_ion_page, null, {\n    default: _withCtx(() => [\n      _createVNode(_component_ion_header, null, {\n        default: _withCtx(() => [\n          _createVNode(_component_ion_toolbar, null, {\n            default: _withCtx(() => [\n              _createVNode(_component_ion_title, { class: \"his-lg-text\" }, {\n                default: _withCtx(() => [\n                  _createVNode(_component_ion_text, { color: \"danger\" }, {\n                    default: _withCtx(() => [\n                      _createTextVNode(_toDisplayString(_ctx.npid), 1)\n                    ]),\n                    _: 1\n                  }),\n                  _createTextVNode(\" Merge history \")\n                ]),\n                _: 1\n              })\n            ]),\n            _: 1\n          })\n        ]),\n        _: 1\n      }),\n      _createVNode(_component_ion_content, null, {\n        default: _withCtx(() => [\n          _createVNode(_component_ion_title, { class: \"his-md-text his-card\" }, {\n            default: _withCtx(() => [\n              _createTextVNode(\"NPID Holder: \")\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_ion_list, null, {\n            default: _withCtx(() => [\n              _createVNode(_component_ion_item, {\n                lines: \"none\",\n                class: \"his-md-text\"\n              }, {\n                default: _withCtx(() => [\n                  _createVNode(_component_ion_label, null, {\n                    default: _withCtx(() => [\n                      _createTextVNode(\" Person name \")\n                    ]),\n                    _: 1\n                  }),\n                  _createElementVNode(\"b\", null, _toDisplayString(_ctx.holderName), 1)\n                ]),\n                _: 1\n              }),\n              (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.patientInfo, (item, index) => {\n                return (_openBlock(), _createBlock(_component_ion_item, {\n                  lines: \"none\",\n                  class: \"his-md-text\",\n                  key: index\n                }, {\n                  default: _withCtx(() => [\n                    _createVNode(_component_ion_label, null, {\n                      default: _withCtx(() => [\n                        _createTextVNode(_toDisplayString(item.label) + \": \", 1)\n                      ]),\n                      _: 2\n                    }, 1024),\n                    _createElementVNode(\"b\", null, _toDisplayString(item.value), 1)\n                  ]),\n                  _: 2\n                }, 1024))\n              }), 128))\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_ion_title, { class: \"his-md-text his-card\" }, {\n            default: _withCtx(() => [\n              _createTextVNode(\"Transactions:\")\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_report_table, {\n            config: { tableCssTheme: 'art-report-theme'},\n            columns: _ctx.columns,\n            rows: _ctx.rows\n          }, null, 8, [\"columns\", \"rows\"])\n        ]),\n        _: 1\n      }),\n      _createVNode(_component_ion_footer, null, {\n        default: _withCtx(() => [\n          _createVNode(_component_ion_toolbar, { color: \"dark\" }, {\n            default: _withCtx(() => [\n              _createVNode(_component_ion_button, {\n                onClick: _ctx.cancel,\n                color: \"danger\",\n                size: \"large\",\n                slot: \"start\"\n              }, {\n                default: _withCtx(() => [\n                  _createTextVNode(\" Cancel \")\n                ]),\n                _: 1\n              }, 8, [\"onClick\"]),\n              _createVNode(_component_ion_button, {\n                onClick: _ctx.rollback,\n                disabled: !_ctx.isReversible,\n                color: \"success\",\n                size: \"large\",\n                slot: \"end\"\n              }, {\n                default: _withCtx(() => [\n                  _createTextVNode(\" Reverse \")\n                ]),\n                _: 1\n              }, 8, [\"onClick\", \"disabled\"])\n            ]),\n            _: 1\n          })\n        ]),\n        _: 1\n      })\n    ]),\n    _: 1\n  }))\n}","import { Service } from \"./service\"\n\nexport interface MergeHistory {\n    id: number;\n    primary_id: number;\n    secondary_id: number;\n    merge_date: string;\n    merge_type: string;\n    primary_first_name: string;\n    primary_surname: string;\n    primary_gender: string;\n    primary_birthdate: string;\n    secondary_first_name: string;\n    secondary_surname: string;\n    secondary_gender: string;\n    secondary_birthdate: string;\n}\n\nexport class MergingService extends Service {\n    static getMergeHistory(identifier: string): Promise<MergeHistory[] | undefined> {\n        return this.getJson(`/rollback/merge_history`, {\n            identifier\n        })\n    }\n\n    static rollback(patientID: number) {\n        return this.postJson(`/rollback/rollback_patient`, {\n            'patient_id': patientID,\n            'program_id': this.getProgramID()\n        })\n    }\n}\n","\nimport { computed, defineComponent, onMounted, ref } from 'vue'\nimport {\n    IonPage,\n    IonContent,\n    IonToolbar,\n    IonHeader,\n    IonFooter,\n    IonTitle,\n    IonList,\n    IonItem,\n    IonText,\n    IonLabel,\n    IonButton\n} from \"@ionic/vue\"\nimport ReportTable from \"@/components/DataViews/tables/ReportDataTable.vue\"\nimport table from \"@/components/DataViews/tables/ReportDataTable\"\nimport { MergingService, MergeHistory } from \"@/services/merging_service\"\nimport { Option } from '@/components/Forms/FieldInterface'\nimport { useRoute, useRouter } from 'vue-router'\nimport { alertConfirmation, toastDanger } from '@/utils/Alerts'\nimport HisDate from \"@/utils/Date\"\n\nexport default defineComponent({\n    components: {\n        IonText,\n        IonPage,\n        IonContent,\n        IonToolbar,\n        IonHeader,\n        IonFooter,\n        IonTitle,\n        IonList,\n        IonItem,\n        IonLabel,\n        IonButton,\n        ReportTable\n    },\n    setup() {\n        const route = useRoute()\n        const router = useRouter()\n        const patientID = ref(-1)\n        const rows = ref([] as any)\n        const results = ref([] as MergeHistory[])\n        const npid = `${route.params.id}`.toUpperCase() as string\n        const holderName = ref('N/A' as string)\n        const patientInfo = ref([\n            { label: 'Birthdate', value: 'N/A'},\n            { label: 'Gender', value: 'N/A'},\n        ] as Option[])\n        const columns = [\n            [\n                table.thTxt('Merge type'),\n                table.thTxt('Merge date'),\n                table.thTxt('First Name'),\n                table.thTxt('Last name'),\n                table.thTxt('Birthdate'),\n                table.thTxt('Gender'),\n            ]\n        ]\n\n        const isReversible = computed(() => results.value.length > 0)\n\n        onMounted(async () => {\n            if (!npid) {\n                router.back()\n                return\n            }\n            try {\n                results.value = (await MergingService.getMergeHistory(npid) || [])\n            } catch (e) {\n                toastDanger(`Merge history not found for ${npid}`)\n            }\n            rows.value = results.value.map((item: MergeHistory) => {\n                if (patientID.value === -1) {\n                    patientID.value = item['secondary_id']\n                    holderName.value =`${item['secondary_first_name']} ${item['secondary_surname']}`\n                    patientInfo.value = [\n                        { label: 'Birthdate', value: HisDate.toStandardHisDisplayFormat(\n                            item['secondary_birthdate']\n                        )},\n                        { label: 'Gender', value: item['secondary_gender']},\n                    ]\n                }\n                return [\n                    table.td(item['merge_type']),\n                    table.tdDate(item['merge_date']),\n                    table.td(item['primary_first_name']),\n                    table.td(item['primary_surname']),\n                    table.tdDate(item['primary_birthdate']),\n                    table.td(item['primary_gender'])\n                ]\n            })\n        })\n\n        function cancel() {\n            router.back()\n        }\n\n        async function rollback() {\n            if ((await alertConfirmation('Are you sure you want to merge transactions'))) {\n                if ((await MergingService.rollback(patientID.value))) {\n                    router.back()\n                } else {\n                    toastDanger('Failed to rollback')\n                }\n            }\n        }\n\n        return {\n            cancel,\n            holderName,\n            isReversible,\n            patientInfo,\n            rollback,\n            columns,\n            rows,\n            npid\n        }\n    }\n})\n","import { render } from \"./MergeRollback.vue?vue&type=template&id=45cde8b0&scoped=true&ts=true\"\nimport script from \"./MergeRollback.vue?vue&type=script&lang=ts\"\nexport * from \"./MergeRollback.vue?vue&type=script&lang=ts\"\n\nimport \"./MergeRollback.vue?vue&type=style&index=0&id=45cde8b0&scoped=true&lang=css\"\n\nimport exportComponent from \"/home/daniel/projects/malawi-emr/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-45cde8b0\"]])\n\nexport default __exports__"],"sourceRoot":""}